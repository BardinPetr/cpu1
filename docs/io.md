## Подсистема ввода-вывода

Подсистема с контроллером и устройствами: [machine/io](src/machine/io)

### Устройство

IO Шина:

- сигналы управления, 3 бит
- шина данных 32 бит
    - все устройства подключены к шине через буферы с третьим состоянием
- шина адреса 16 бит
- сигнал тактирования

Все устройства на шине имеют собственный диапазон адресов, каждый адрес определяется регистр устройства.

### Процесс обмена данными

Передача информации между CPU и контроллером происходит
в сторону от CPU по шине C
(последовательно туда надо размещать адрес и данные, сопровождая их соответствующими командами управления контроллером
для сохранения адреса, данных и затем запросами на ввод/вывод);
в сторону от контроллера по шине `io_ctrl_data_output`.

#### Запись

CPU устанавливает в регистрах контроллера адрес и значение на запись, затем отправляет сигнал на запись,
после чего контроллер по заднему фронту сигнала тактирования выставляет на шинах данных и адреса значения, а также
сигнал записи.

По переднему фронту сигнала тактирования при установленном значении на управляющем сигнале записи
устройство может проверить адрес на шине адреса и при совпадении со своим диапазоном использовать значение с шины
данных.

#### Чтение

CPU устанавливает в регистрах контроллера адрес, затем отправляет сигнал на чтение,
после чего контроллер по заднему фронту сигнала тактирования выставляет на шине адреса адрес,
а также выдает сигнал чтения.

По переднему фронту сигнала тактирования при установленном значении на управляющем сигнале чтения
устройство может проверить адрес на шине адреса, после чего выставить на шине данных значение.
По заднему фронту контроллер считывает значение с шины данных и выдает его в свой выходной регистр,
и выставляет на сигнал завершения чтения на шину. По следующему переднему фронту
при установленном сигнале завершения устройство может снимать с шины данных значение и отключиться от нее.

### Реализованные устройства

- "Принтер"
    - 0x10 r/o - занятость
    - 0x11 w/o - вывод символа
    - 0x12 w/o - вывод 32 битного числа как строки
- "Клавиатура"
    - 0x10 r/o - занятость
    - 0x11 w/o - следующий считанный символ
